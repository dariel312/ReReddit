var ApiInterceptor=function($q,$window,$injector){return{request:function(config){var api=$injector.get("api"),url=config.url.split("/");return api.isLoggedIn()&&(url[1]=="api"||url[0]=="api")&&(config.headers.Authorization="Bearer "+api.getAuthToken()),config},responseError:function(rejection){if(rejection.status===401){var api=$injector.get("api");api.logOff()}else return $q.reject(rejection)}}};const ApiService=function($http,$window,$rootScope,$httpParamSerializer,$state,$q,$timeout){function _get(url,parameters){return(parameters===null||parameters===undefined)&&(parameters={}),$http.get(url,{params:parameters})}function _post(url,data){return(data===null||data===undefined)&&(data={}),$http.post(url,data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function onAuthChanged(){$timeout(function(){$rootScope.$broadcast("auth-changed");console.log("AUTH CHANGE BOOM")})}const self=this,host="https://www.reddit.com";let client_id="t1woxVATacs9Wg",client_secret="",redirect_uri="http://localhost:55840/auth";const api_scope="identity, edit, flair, history, modconfig, modflair, modlog, modposts, modwiki, mysubreddits, privatemessages, read, report, save, submit, subscribe, vote, wikiedit, wikiread",token_key="auth_token";var auth_info=null,identity=null;ENVIRONMENT=="PROD"&&(client_id="TDmT_7LQ_5LkmQ",client_secret="",redirect_uri="http://rereddit.dariel.io/auth");auth_info=JSON.parse($window.localStorage.getItem(token_key));this.getPost=function(subreddit,id){return _get(host+"/r/"+subreddit+"/comments/"+id+".json")};this.getSubredditPosts=function(subreddit,params){return this.isLoggedIn()?subreddit==null?_get("api/hot",params):_get("api/r/"+subreddit,params):subreddit==null?_get(host+"/.json",params):_get(host+"/r/"+subreddit+".json",params)};this.vote=function(id,dir){return _post("/api/api/vote",$httpParamSerializer({id:id,dir:dir}))};this.getSubredditAbout=function(subreddit){return this.isLoggedIn()?_get("api/r/"+subreddit+"/about"):_get(host+"/r/"+subreddit+"/about.json")};this.getSubredditRules=function(subreddit){return this.isLoggedIn()?_get("api/r/"+subreddit+"/about/rules"):_get(host+"/r/"+subreddit+"/about/rules.json")};this.getSubreddits=function(){return this.isLoggedIn()?_get("api/subreddits/mine/subscriber"):_get(host+"/subreddits/popular.json")};this.redirectAuthUrl=function(){$window.location.href="https://www.reddit.com/api/v1/authorize?client_id="+client_id+"&response_type=token&state=12345&redirect_uri="+redirect_uri+"&scope="+api_scope};this.setAuth=function(response){response.expires_at=moment().add(response.expires_in,"seconds");$window.localStorage.setItem(token_key,JSON.stringify(response));auth_info=response;onAuthChanged()};this.logOff=function(){self.isLoggedIn&&($window.localStorage.removeItem(token_key),auth_info=null,onAuthChanged(),$state.go("home"))};this.getAuthToken=function(){return auth_info==null?null:auth_info.access_token};this.isLoggedIn=function(){return auth_info==null?!1:moment(auth_info.expires_at).isAfter(moment())?!0:!1};this.getMe=function(){var deferred=$q.defer();return identity!=null?$timeout(function(){deferred.resolve(identity)}):_get("/api/api/v1/me").then(function(response){return identity=response.data,deferred.resolve(identity),response},function(response){return deferred.reject(response),response}),deferred.promise}},AuthComponent={template:"",controller:function($stateParams,$window,$state,api){function getHashParams(){for(var hashParams={},e,a=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=$window.location.hash.substring(1);e=r.exec(q);)hashParams[d(e[1])]=d(e[2]);return hashParams}$ctrl=this;$ctrl.$onInit=function(){var c=getHashParams();c.access_token!==undefined&&api.setAuth(c);$state.go("home")}}},BigNumberFilter=function(){return function(number){return abs=Math.abs(number),abs>=Math.pow(10,12)?number=(number/Math.pow(10,12)).toFixed(1)+"t":abs<Math.pow(10,12)&&abs>=Math.pow(10,9)?number=(number/Math.pow(10,9)).toFixed(1)+"b":abs<Math.pow(10,9)&&abs>=Math.pow(10,6)?number=(number/Math.pow(10,6)).toFixed(1)+"m":abs<Math.pow(10,6)&&abs>=Math.pow(10,3)&&(number=(number/Math.pow(10,3)).toFixed(1)+"k"),number}},DefaultIconComponent={template:`
          <svg class="s545dfq-6 fvTVVq jqg8ml-1 ghnDxa" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" 
             style="width: 32px;
                    height: 32px;
                    margin: 0 0.5rem;
                    color: rgb(255, 255, 255);
                    fill: rgb(255, 255, 255);
                    background: rgb(0, 121, 211);   
                    border-radius: 50%;
                    padding: 3px;" 
            ng-style="{'background': $ctrl.color }">
            <path d="M15.8286,15.8998 C15.3466,16.3788 12.6326,15.5598 8.5516,11.4798 C4.4706,7.3968 3.6486,4.6858 4.1316,4.2038 C4.3566,3.9788 4.9286,3.9208 5.9126,4.3518 C5.6166,4.5678 5.3306,4.8008 5.0666,5.0658 C5.0536,5.0798 5.0416,5.0948 5.0266,5.1098 C5.5756,6.4268 6.8946,8.4088 9.2596,10.7728 C11.6206,13.1338 13.6046,14.4538 14.9246,15.0028 C14.9376,14.9898 14.9526,14.9778 14.9666,14.9638 C15.2316,14.6988 15.4646,14.4128 15.6786,14.1178 C16.1096,15.1028 16.0526,15.6748 15.8286,15.8998 M16.7526,11.8998 C17.4066,9.5458 16.8136,6.9138 14.9666,5.0658 C13.6436,3.7438 11.8866,3.0148 10.0166,3.0148 C9.3686,3.0148 8.7356,3.1078 8.1286,3.2768 C5.7306,1.7598 3.9176,1.5898 2.7176,2.7898 C1.4036,4.1028 2.0736,6.1918 3.2866,8.1688 C2.6446,10.5128 3.2276,13.1258 5.0666,14.9638 C6.3886,16.2868 8.1456,17.0148 10.0166,17.0148 C10.6536,17.0148 11.2746,16.9178 11.8736,16.7518 C13.0856,17.4938 14.3406,18.0318 15.4316,18.0318 C16.1156,18.0318 16.7366,17.8198 17.2426,17.3138 C18.4416,16.1138 18.2706,14.2988 16.7526,11.8998"></path>
          </svg>
        `,bindings:{color:"<"},controller:function(){var $ctrl=this;$ctrl.$onChanges=function(){($ctrl.color==""||$ctrl.color==undefined)&&($ctrl.color="rgb(0, 121, 211)")}}},HtmlDecodeFilter=function(){return function(html,isRaw){var decoded;return html==undefined?"":isRaw==!1?SnuOwnd.getParser().render(html):angular.element("<textarea />").html(html).text()}},PostLikeComponent={template:`
           <div class="d-flex flex-column justify-content-center">
                <button class="btn btn-icon btn-link" ng-click="$ctrl.onLike(1, $event)"><i class="material-icons">keyboard_arrow_up</i></button>
                <span class="text-center" ng-class="{'text-danger': $ctrl.liked === -1, 'text-primary': $ctrl.liked === 1}">{{$ctrl.ups | bignumber }}</span>
                <button class="btn btn-icon btn-link" ng-click="$ctrl.onLike(-1, $event)"><i class="material-icons">keyboard_arrow_down</i></button>
            </div>
        `,bindings:{ups:"<",name:"<"},controller:function(api){var $ctrl=this;$ctrl.liked=0;$ctrl.onLike=function(dir,$event){if($event.stopPropagation(),!api.isLoggedIn()){alert("Must be logged in to do that.");return}dir===1?$ctrl.liked===1?(dir=0,$ctrl.ups--):$ctrl.ups+=$ctrl.liked===-1?2:1:dir===-1&&($ctrl.liked===-1?(dir=0,$ctrl.ups++):$ctrl.ups-=$ctrl.liked===1?2:1);$ctrl.liked=dir;api.vote($ctrl.name,dir).then(function(){},function(){alert("You're doing that too much.")})}}},PostMediaComponent={templateUrl:"/app/common/post-media.component.html",bindings:{post:"<"},controller:function(){var $ctrl=this}},YoutubeEmbedComponent={template:`
            <div class="video-responsive" ng-style="{'height' : $ctrl.media.height}">
                <img ng-src="{{$ctrl.media.thumbnail_url}}" class="img-fluid card-img mx-auto" ng-click="$ctrl.playYoutube($event)" ng-if="!$ctrl.showYoutube" />
                <svg class="yt-button" version="1.1" viewBox="0 0 68 48" ng-if="!$ctrl.showYoutube" ng-click="$ctrl.playYoutube($event)">
                    <path class="ytp-large-play-button-bg" d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#212121" fill-opacity="0.8"></path><path d="M 45,24 27,14 27,34" fill="#fff"></path>                </svg>
                <div ng-bind-html="$ctrl.video_embed" ng-if="$ctrl.showYoutube"></div>
            </div>
        `,bindings:{media:"<"},controller:function($filter,$sce){var $ctrl=this;$ctrl.showYoutube=!1;$ctrl.playYoutube=function($event){var html,obj,newObj;$event.stopPropagation();html=$filter("htmldecode")($ctrl.media.html,!0);obj=angular.element(html);obj.attr("src",obj.attr("src")+"&autoplay=1");newObj=angular.element("<div>").append(obj);$ctrl.video_embed=$sce.trustAsHtml(newObj.html());$ctrl.showYoutube=!0}}},HomeComponent={templateUrl:"/app/home/home.component.html",controller:function(){}},NavbarComponent={templateUrl:"/app/navbar/navbar.component.html",controller:function($rootScope,$state,$transitions,api){var $ctrl=this;$ctrl.logged_in=api.isLoggedIn();$ctrl.subreddits=[];$ctrl.subredditName=null;$ctrl.user=null;$ctrl.current="FrontPage";$ctrl.$onInit=function(){$rootScope.$on("auth-changed",function(){$ctrl.logged_in=api.isLoggedIn()});$transitions.onSuccess({},function(transition){var to=transition.to(),params=transition.params();to.name=="subreddit"?$ctrl.current=params.name:to.name=="home"&&($ctrl.current="Home")});api.getSubreddits().then(function(response){$ctrl.subreddits=response.data.data.children});api.getMe().then(function(user){$ctrl.user=user})};$ctrl.onLogin=function(){api.redirectAuthUrl()};$ctrl.onLogout=function(){api.logOff()};$ctrl.submit=function(){$state.go("subreddit",{name:$ctrl.subredditName});$ctrl.subredditName=null}}},SubredditCardviewComponent={templateUrl:"/app/subreddit/subreddit-cardview.component.html",bindings:{post:"<"},controller:function(){var $ctrl=this}},SubredditCommentComponent={templateUrl:"/app/subreddit/subreddit-comment.component.html",bindings:{comment:"<",depth:"<"},controller:function(){var $ctrl=this}},SubredditPostComponent={templateUrl:"/app/subreddit/subreddit-post.component.html",controller:function($stateParams,$state,api){var $ctrl=this;$ctrl.name=$stateParams.subreddit;$ctrl.comments=[];$ctrl.post=$stateParams.post;let html=angular.element("html"),onEscHandler=function(e){e.keyCode==27&&$state.go("^")};this.$onInit=function(){html.addClass("freeze-scroll");angular.element(document).keyup(onEscHandler);$stateParams.subreddit==null&&($ctrl.name=$stateParams.name);$ctrl.name==null&&$state.go("^");api.getPost($ctrl.name,$stateParams.id).then(function(result){$ctrl.post==null&&($ctrl.post=result.data[0].data.children[0].data);var cmts=[];result.data.splice(0,1);angular.forEach(result.data,list=>angular.forEach(list.data.children,comment=>cmts.push(comment.data)));$ctrl.comments=cmts},function(){$state.go("^")})};this.$onDestroy=function(){html.removeClass("freeze-scroll");angular.element(document).unbind("keyup",onEscHandler)}}},SubredditSidebarComponent={templateUrl:"/app/subreddit/subreddit-sidebar.component.html",bindings:{about:"<",rules:"<"},controller:function(){var $ctrl=this}},SubredditComponent={templateUrl:"/app/subreddit/subreddit.component.html",controller:function($stateParams,$window,api){var $ctrl=this;$ctrl.name=$stateParams.name;$ctrl.listing=[];$ctrl.posts=[];$ctrl.placeholders=[{},{},{},{},{}];$ctrl.about=null;$ctrl.rules=null;$ctrl.next=function(){console.log($ctrl.listing);api.getSubredditPosts($stateParams.name,{before:$ctrl.listing.after,count:$ctrl.posts.length}).then(function(result){$ctrl.listing=result.data.data;result.data.data.children.forEach(function(item){$ctrl.posts.push(item)})})};$ctrl.$onInit=function(){angular.element(window).scrollTop(0);api.getSubredditPosts($stateParams.name).then(function(result){$ctrl.listing=result.data.data;$ctrl.posts=result.data.data.children;$ctrl.placeholders=[]});api.getSubredditAbout($stateParams.name).then(function(result){$ctrl.about=result.data.data;var html=document.getElementsByTagName("html")[0];html.style.setProperty("--subreddit-primary-color",$ctrl.about.primary_color);html.style.setProperty("--subreddit-key-color",$ctrl.about.key_color);$window.document.title="Re: "+$ctrl.about.title});api.getSubredditRules($stateParams.name).then(function(result){$ctrl.rules=result.data.rules})}}};(function(){"use strict";var app=angular.module("app",["ngAnimate","ngSanitize","ui.router","angularMoment"]);app.service("api",ApiService);app.component("appNavbar",NavbarComponent);app.component("appHome",HomeComponent);app.component("appSubreddit",SubredditComponent);app.component("appSubredditPost",SubredditPostComponent);app.component("appSubredditCardview",SubredditCardviewComponent);app.component("appSubredditComment",SubredditCommentComponent);app.component("appSubredditSidebar",SubredditSidebarComponent);app.component("appAuth",AuthComponent);app.component("postLike",PostLikeComponent);app.component("postMedia",PostMediaComponent);app.component("defaultIcon",DefaultIconComponent);app.component("youtubeEmbed",YoutubeEmbedComponent);app.filter("bignumber",BigNumberFilter);app.filter("htmldecode",HtmlDecodeFilter);app.config(function($locationProvider,$urlRouterProvider,$stateProvider,$httpProvider,$rootScopeProvider){$locationProvider.html5Mode(!0);$rootScopeProvider.digestTtl(15);$urlRouterProvider.otherwise("/");$stateProvider.state("subreddit",{url:"/r/{name}",component:"appSubreddit",params:{name:null}}).state("subreddit.post",{url:"/{id}",component:"appSubredditPost",params:{post:null,id:null,subreddit:null}}).state("home",{url:"/",component:"appSubreddit",params:{name:null}}).state("home.post",{url:"r/{subreddit}/{id}",component:"appSubredditPost",params:{post:null,id:null,subreddit:null}}).state("auth",{url:"/auth",component:"appAuth"});$httpProvider.interceptors.push(ApiInterceptor)})})();