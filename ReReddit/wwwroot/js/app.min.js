var ApiInterceptor=function($q,$window,$injector){return{request:function(config){var api=$injector.get("api"),url=config.url.split("/");return api.isLoggedIn()&&(url[1]=="api"||url[0]=="api")&&(config.headers.Authorization="Bearer "+api.getAuthToken()),config},responseError:function(rejection){if(rejection.status===401){var api=$injector.get("api");api.logOff()}else return $q.reject(rejection)}}};const ApiService=function($http,$window,$rootScope){function _get(url,parameters){return(parameters===null||parameters===undefined)&&(parameters={}),$http.get(url,{params:parameters})}function _post(url,data){return(data===null||data===undefined)&&(data={}),$http.post(url,data,{headers:{"Content-Type":undefined}})}function onAuthChanged(){$rootScope.$broadcast("auth-changed")}const self=this,host="https://www.reddit.com",client_id="TDmT_7LQ_5LkmQ",redirect_uri="http://localhost:55840/auth",api_scope="identity, edit, flair, history, modconfig, modflair, modlog, modposts, modwiki, mysubreddits, privatemessages, read, report, save, submit, subscribe, vote, wikiedit, wikiread",token_key="auth_token";var auth_info=null;auth_info=JSON.parse($window.localStorage.getItem(token_key));this.getPost=function(subreddit,id){return _get(host+"/r/"+subreddit+"/comments/"+id+".json")};this.getSubreddit=function(subreddit){return subreddit==null?_get(host+"/.json"):_get(host+"/r/"+subreddit+".json")};this.vote=function(id,dir){return _post("/api/vote.json",{id:id,dir:dir})};this.redirectAuthUrl=function(){$window.location.href="https://www.reddit.com/api/v1/authorize?client_id="+client_id+"&response_type=token&state=12345&redirect_uri="+redirect_uri+"&scope="+api_scope};this.setAuth=function(response){response.expires_at=moment().add(response.expires_in,"seconds");$window.localStorage.setItem(token_key,JSON.stringify(response));onAuthChanged()};this.logOff=function(){self.isLoggedIn&&($window.localStorage.removeItem(token_key),onAuthChanged())};this.getAuthToken=function(){return auth_info.access_token};this.isLoggedIn=function(){return auth_info==null?!1:moment(auth_info.expires_at).isAfter(moment())?!0:!1}},AuthComponent={template:"",controller:function($stateParams,$window,$state,api){function getHashParams(){for(var hashParams={},e,a=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=$window.location.hash.substring(1);e=r.exec(q);)hashParams[d(e[1])]=d(e[2]);return hashParams}$ctrl=this;var c=getHashParams();c.access_token!==undefined&&api.setAuth(c);$state.go("home")}},FooterComponent={templateUrl:"/app/footer/footer.component.html",controller:function(){}},HomeComponent={templateUrl:"/app/home/home.component.html",controller:function(){}},NavbarComponent={templateUrl:"/app/navbar/navbar.component.html",controller:function($rootScope,api){var $ctrl=this;$ctrl.logged_in=api.isLoggedIn();$ctrl.onLogin=function(){console.log("poop");api.redirectAuthUrl()};$rootScope.$on("auth-changed",function(){alert("OMG AUTH CHANGED FROM NAVBAR")})}},SubredditCardviewComponent={templateUrl:"/app/subreddit/subreddit-cardview.component.html",bindings:{post:"<"},controller:function(api){var $ctrl=this;$ctrl.$onInit=function(){$ctrl.post.liked=0};$ctrl.onLike=function(post,$event){$event.stopPropagation();post.liked===0?(post.ups++,post.liked=1,api.vote(post.name,1)):post.liked===1&&(post.ups--,post.liked=0)};$ctrl.onDisLike=function(post,$event){$event.stopPropagation();post.liked===0?(post.ups--,post.liked=-1,api.vote(post.name,-1)):post.liked===-1&&(post.ups++,post.liked=0)};$ctrl.click=function(){alert("clicked")}}},SubredditCommentComponent={templateUrl:"/app/subreddit/subreddit-comment.component.html",bindings:{comment:"="},controller:function(){var $ctrl=this}},SubredditPostComponent={templateUrl:"/app/subreddit/subreddit-post.component.html",controller:function($stateParams,$state,$sce,api){var $ctrl=this;$ctrl.name=$stateParams.name;$ctrl.comments=[];$ctrl.post=$stateParams.post;let html=angular.element("html");this.$onInit=function(){html.addClass("freeze-scroll")};this.$onDestroy=function(){html.removeClass("freeze-scroll")};$stateParams.name==null&&$state.go("^");api.getPost($stateParams.name,$stateParams.id).then(function(result){$ctrl.post==null&&($ctrl.post=result.data[0].data.children[0].data);var cmts=[];result.data.splice(0,1);angular.forEach(result.data,list=>angular.forEach(list.data.children,comment=>cmts.push(comment.data)));$ctrl.comments=cmts},function(){$state.go("^")})}},SubredditComponent={templateUrl:"/app/subreddit/subreddit.component.html",controller:function($stateParams,api){var $ctrl=this;$ctrl.name=$stateParams.name;$ctrl.listing=[];$ctrl.posts=[];api.getSubreddit($stateParams.name).then(function(result){$ctrl.listing=result.data.data;$ctrl.posts=result.data.data.children})}};(function(){"use strict";var app=angular.module("app",["ngAnimate","ngSanitize","ui.router","angularMoment"]);app.service("api",ApiService);app.component("appNavbar",NavbarComponent);app.component("appFooter",FooterComponent);app.component("appHome",HomeComponent);app.component("appSubreddit",SubredditComponent);app.component("appSubredditPost",SubredditPostComponent);app.component("appSubredditCardview",SubredditCardviewComponent);app.component("appSubredditComment",SubredditCommentComponent);app.component("appAuth",AuthComponent);app.config(function($locationProvider,$urlRouterProvider,$stateProvider,$httpProvider){$locationProvider.html5Mode(!0);$urlRouterProvider.otherwise("/");$stateProvider.state("subreddit",{url:"/r/{name}",component:"appSubreddit"}).state("subreddit.post",{url:"/{id}",component:"appSubredditPost",params:{post:null,id:null}}).state("home",{url:"/",component:"appSubreddit",params:{name:null}}).state("auth",{url:"/auth",component:"appAuth"});$httpProvider.interceptors.push(ApiInterceptor)})})();