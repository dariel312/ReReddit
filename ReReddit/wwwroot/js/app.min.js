var ApiInterceptor=function($q,$window,$injector){return{request:function(config){var api=$injector.get("api"),url=config.url.split("/");return api.isLoggedIn()&&(url[1]=="api"||url[0]=="api")&&(config.headers.Authorization="Bearer "+api.getAuthToken()),config},responseError:function(rejection){if(rejection.status===401){var api=$injector.get("api");api.logOff()}else return $q.reject(rejection)}}};const ApiService=function($http,$window,$rootScope,$httpParamSerializer,$state){function _get(url,parameters){return(parameters===null||parameters===undefined)&&(parameters={}),$http.get(url,{params:parameters})}function _post(url,data){return(data===null||data===undefined)&&(data={}),$http.post(url,data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function onAuthChanged(){$rootScope.$broadcast("auth-changed")}const self=this,host="https://www.reddit.com",client_id="TDmT_7LQ_5LkmQ",redirect_uri="http://localhost:55840/auth",api_scope="identity, edit, flair, history, modconfig, modflair, modlog, modposts, modwiki, mysubreddits, privatemessages, read, report, save, submit, subscribe, vote, wikiedit, wikiread",token_key="auth_token";var auth_info=null;auth_info=JSON.parse($window.localStorage.getItem(token_key));this.getPost=function(subreddit,id){return _get(host+"/r/"+subreddit+"/comments/"+id+".json")};this.getSubreddit=function(subreddit){return this.isLoggedIn()?subreddit==null?_get("api/hot"):_get("api/r/"+subreddit):subreddit==null?_get(host+"/.json"):_get(host+"/r/"+subreddit+".json")};this.vote=function(id,dir){return _post("/api/api/vote",$httpParamSerializer({id:id,dir:dir}))};this.getSubredditAbout=function(subreddit){return this.isLoggedIn()?_get("api/r/"+subreddit+"/about"):_get(host+"/r/"+subreddit+"/about.json")};this.getSubredditRules=function(subreddit){return this.isLoggedIn()?_get("api/r/"+subreddit+"/about/rules"):_get(host+"/r/"+subreddit+"/about/rules.json")};this.redirectAuthUrl=function(){$window.location.href="https://www.reddit.com/api/v1/authorize?client_id="+client_id+"&response_type=token&state=12345&redirect_uri="+redirect_uri+"&scope="+api_scope};this.setAuth=function(response){response.expires_at=moment().add(response.expires_in,"seconds");$window.localStorage.setItem(token_key,JSON.stringify(response));onAuthChanged()};this.logOff=function(){self.isLoggedIn&&($window.localStorage.removeItem(token_key),onAuthChanged(),$state.go("home"))};this.getAuthToken=function(){return auth_info==null?null:auth_info.access_token};this.isLoggedIn=function(){return auth_info==null?!1:moment(auth_info.expires_at).isAfter(moment())?!0:!1}},AuthComponent={template:"",controller:function($stateParams,$window,$state,api){function getHashParams(){for(var hashParams={},e,a=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=$window.location.hash.substring(1);e=r.exec(q);)hashParams[d(e[1])]=d(e[2]);return hashParams}$ctrl=this;var c=getHashParams();c.access_token!==undefined&&api.setAuth(c);$state.go("home")}},BigNumberFilter=function(){return function(number){return abs=Math.abs(number),abs>=Math.pow(10,12)?number=(number/Math.pow(10,12)).toFixed(1)+"t":abs<Math.pow(10,12)&&abs>=Math.pow(10,9)?number=(number/Math.pow(10,9)).toFixed(1)+"b":abs<Math.pow(10,9)&&abs>=Math.pow(10,6)?number=(number/Math.pow(10,6)).toFixed(1)+"m":abs<Math.pow(10,6)&&abs>=Math.pow(10,3)&&(number=(number/Math.pow(10,3)).toFixed(1)+"k"),number}},DefaultIconComponent={template:`
          <svg class="s545dfq-6 fvTVVq jqg8ml-1 ghnDxa" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" 
             style="width: 32px;
                    height: 32px;
                    margin: 0 0.5rem;
                    color: rgb(255, 255, 255);
                    fill: rgb(255, 255, 255);
                    background: rgb(0, 121, 211);   
                    border-radius: 50%;
                    padding: 3px;" 
            ng-style="{'background': $ctrl.color }">
            <path d="M15.8286,15.8998 C15.3466,16.3788 12.6326,15.5598 8.5516,11.4798 C4.4706,7.3968 3.6486,4.6858 4.1316,4.2038 C4.3566,3.9788 4.9286,3.9208 5.9126,4.3518 C5.6166,4.5678 5.3306,4.8008 5.0666,5.0658 C5.0536,5.0798 5.0416,5.0948 5.0266,5.1098 C5.5756,6.4268 6.8946,8.4088 9.2596,10.7728 C11.6206,13.1338 13.6046,14.4538 14.9246,15.0028 C14.9376,14.9898 14.9526,14.9778 14.9666,14.9638 C15.2316,14.6988 15.4646,14.4128 15.6786,14.1178 C16.1096,15.1028 16.0526,15.6748 15.8286,15.8998 M16.7526,11.8998 C17.4066,9.5458 16.8136,6.9138 14.9666,5.0658 C13.6436,3.7438 11.8866,3.0148 10.0166,3.0148 C9.3686,3.0148 8.7356,3.1078 8.1286,3.2768 C5.7306,1.7598 3.9176,1.5898 2.7176,2.7898 C1.4036,4.1028 2.0736,6.1918 3.2866,8.1688 C2.6446,10.5128 3.2276,13.1258 5.0666,14.9638 C6.3886,16.2868 8.1456,17.0148 10.0166,17.0148 C10.6536,17.0148 11.2746,16.9178 11.8736,16.7518 C13.0856,17.4938 14.3406,18.0318 15.4316,18.0318 C16.1156,18.0318 16.7366,17.8198 17.2426,17.3138 C18.4416,16.1138 18.2706,14.2988 16.7526,11.8998"></path>
          </svg>
        `,bindings:{color:"<"},controller:function(){var $ctrl=this;$ctrl.$onChanges=function(){($ctrl.color==""||$ctrl.color==undefined)&&($ctrl.color="rgb(0, 121, 211)")}}},HtmlDecodeFilter=function(){return function(html){return angular.element("<textarea />").html(html).text()}},PostLikeComponent={template:`
           <div class="d-flex flex-column justify-content-center">
                <button class="btn btn-icon btn-link" ng-click="$ctrl.onLike(1, $event)"><i class="material-icons">keyboard_arrow_up</i></button>
                <span class="text-center" ng-class="{'text-danger': $ctrl.liked === -1, 'text-primary': $ctrl.liked === 1}">{{$ctrl.ups | bignumber }}</span>
                <button class="btn btn-icon btn-link" ng-click="$ctrl.onLike(-1, $event)"><i class="material-icons">keyboard_arrow_down</i></button>
            </div>
        `,bindings:{ups:"<",name:"<"},controller:function(api){var $ctrl=this;$ctrl.liked=0;$ctrl.onLike=function(dir,$event){if($event.stopPropagation(),!api.isLoggedIn()){alert("Must be logged in to do that.");return}dir===1?$ctrl.liked===1?(dir=0,$ctrl.ups--):$ctrl.ups+=$ctrl.liked===-1?2:1:dir===-1&&($ctrl.liked===-1?(dir=0,$ctrl.ups++):$ctrl.ups-=$ctrl.liked===1?2:1);$ctrl.liked=dir;api.vote($ctrl.name,dir).then(function(){},function(){alert("You're doing that too much.")})}}},HomeComponent={templateUrl:"/app/home/home.component.html",controller:function(){}},NavbarComponent={templateUrl:"/app/navbar/navbar.component.html",controller:function($rootScope,api){var $ctrl=this;$ctrl.logged_in=api.isLoggedIn();$ctrl.onLogin=function(){api.redirectAuthUrl()};$ctrl.onLogout=function(){api.logOff()};$rootScope.$on("auth-changed",function(){$ctrl.logged_in=api.isLoggedIn();alert.log("auth changed from nav")})}},SubredditCardviewComponent={templateUrl:"/app/subreddit/subreddit-cardview.component.html",bindings:{post:"<"},controller:function(api){var $ctrl=this;$ctrl.$onInit=function(){$ctrl.post.liked=0};$ctrl.onLike=function(dir,$event){$event.stopPropagation();var post=$ctrl.post;dir===1?post.liked===1?(dir=0,post.ups--):post.ups+=post.liked===-1?2:1:dir===-1&&(post.liked===-1?(dir=0,post.ups++):post.ups-=post.liked===1?2:1);post.liked=dir;api.vote(post.name,dir).then(function(){},function(){alert("You're doing that too much.")})}}},SubredditCommentComponent={templateUrl:"/app/subreddit/subreddit-comment.component.html",bindings:{comment:"<",depth:"<"},controller:function(){var $ctrl=this}},SubredditPostComponent={templateUrl:"/app/subreddit/subreddit-post.component.html",controller:function($stateParams,$state,api){var $ctrl=this;$ctrl.name=$stateParams.subreddit;$ctrl.comments=[];$ctrl.post=$stateParams.post;let html=angular.element("html");this.$onInit=function(){html.addClass("freeze-scroll");$stateParams.subreddit==null&&($ctrl.name=$stateParams.name);$ctrl.name==null&&$state.go("^");api.getPost($ctrl.name,$stateParams.id).then(function(result){$ctrl.post==null&&($ctrl.post=result.data[0].data.children[0].data);var cmts=[];result.data.splice(0,1);angular.forEach(result.data,list=>angular.forEach(list.data.children,comment=>cmts.push(comment.data)));$ctrl.comments=cmts},function(){$state.go("^")})};this.$onDestroy=function(){html.removeClass("freeze-scroll")}}},SubredditSidebarComponent={templateUrl:"/app/subreddit/subreddit-sidebar.component.html",bindings:{about:"<",rules:"<"},controller:function(){var $ctrl=this}},SubredditComponent={templateUrl:"/app/subreddit/subreddit.component.html",controller:function($stateParams,api){var $ctrl=this;$ctrl.name=$stateParams.name;$ctrl.listing=[];$ctrl.posts=[];$ctrl.about=null;$ctrl.rules=null;$ctrl.$onInit=function(){api.getSubreddit($stateParams.name).then(function(result){$ctrl.listing=result.data.data;$ctrl.posts=result.data.data.children});api.getSubredditAbout($stateParams.name).then(function(result){$ctrl.about=result.data.data});api.getSubredditRules($stateParams.name).then(function(result){$ctrl.rules=result.data.rules})}}};(function(){"use strict";var app=angular.module("app",["ngAnimate","ngSanitize","ui.router","angularMoment"]);app.service("api",ApiService);app.component("appNavbar",NavbarComponent);app.component("appHome",HomeComponent);app.component("appSubreddit",SubredditComponent);app.component("appSubredditPost",SubredditPostComponent);app.component("appSubredditCardview",SubredditCardviewComponent);app.component("appSubredditComment",SubredditCommentComponent);app.component("appSubredditSidebar",SubredditSidebarComponent);app.component("appAuth",AuthComponent);app.component("postLike",PostLikeComponent);app.component("defaultIcon",DefaultIconComponent);app.filter("bignumber",BigNumberFilter);app.filter("htmldecode",HtmlDecodeFilter);app.config(function($locationProvider,$urlRouterProvider,$stateProvider,$httpProvider){$locationProvider.html5Mode(!0);$urlRouterProvider.otherwise("/");$stateProvider.state("subreddit",{url:"/r/{name}",component:"appSubreddit",params:{name:null}}).state("subreddit.post",{url:"/{id}",component:"appSubredditPost",params:{post:null,id:null,subreddit:null}}).state("home",{url:"/",component:"appSubreddit",params:{name:null}}).state("home.post",{url:"r/{subreddit}/{id}",component:"appSubredditPost",params:{post:null,id:null,subreddit:null}}).state("auth",{url:"/auth",component:"appAuth"});$httpProvider.interceptors.push(ApiInterceptor)})})();